<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rasoa Pro - V2</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel pour JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; padding: 0; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .bg-gradient-custom {
            background: linear-gradient(135deg, #f8fafc 0%, #eef2ff 100%);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .animated-blob {
            position: fixed;
            width: 500px;
            height: 500px;
            border-radius: 50%;
            filter: blur(80px);
            z-index: -1;
            opacity: 0.4;
            animation: move 20s infinite alternate;
        }
        @keyframes move {
            from { transform: translate(-10%, -10%) scale(1); }
            to { transform: translate(20%, 20%) scale(1.1); }
        }
    </style>
</head>
<body class="bg-gradient-custom min-h-screen">
    <div id="root"></div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc, serverTimestamp, query } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

        // Configuration Firebase
        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Exposer au scope global pour React
        window.FirebaseSDK = {
            auth, db, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc, serverTimestamp, query,
            signInAnonymously, signInWithCustomToken, onAuthStateChanged
        };
        
        // Sign In immédiat
        const initAuth = async () => {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
                console.log("Auth success");
            } catch (e) {
                console.error("Auth error", e);
            }
        };
        initAuth();
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const Icons = {
            ShoppingCart: ({size=24, className=""}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/>
                    <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/>
                </svg>
            ),
            Truck: ({size=24, className=""}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M10 17h4V5H2v12h3m9 0h2l3-3V5h-5v12Z"/><circle cx="7.5" cy="17.5" r="2.5"/><circle cx="17.5" cy="17.5" r="2.5"/>
                </svg>
            ),
            Users: ({size=24, className=""}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
            ),
            Wallet: ({size=24, className=""}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"/><path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"/>
                </svg>
            ),
            Trash2: ({size=24, className=""}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M3 6h18m-2 0v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2m-6 9v4m4-4v4"/>
                </svg>
            ),
            ChevronRight: ({size=24, className=""}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="m9 18 6-6-6-6"/>
                </svg>
            ),
            Facebook: ({size=24, className=""}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
                </svg>
            ),
            TikTok: ({size=24, className=""}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className={className}>
                    <path d="M19.589 6.686a4.793 4.793 0 0 1-3.28-1.358 4.798 4.798 0 0 1-1.312-3.233V2h-3.1v12.5a2.5 2.5 0 1 1-2.5-2.5c.162 0 .323.015.48.046V8.92a5.574 5.574 0 0 0-.48-.021 5.6 5.6 0 1 0 5.6 5.6V6.11a8.17 8.17 0 0 0 4.592 1.581V4.59a4.773 4.773 0 0 1-1e-3 2.096Z" fill="currentColor"/>
                </svg>
            ),
            Package: ({size=24, className=""}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="m7.5 4.27 9 5.15m-9 5.15 9-5.15m-9 5.15V19.5l9-5.15V4.27l-9 5.15ZM21 8v8l-9 5.15L3 16V8l9-5.15L21 8Z"/>
                </svg>
            ),
            Plus: ({size=24, className=""}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M12 5v14M5 12h14"/>
                </svg>
            )
        };

        const LOGO_URL = "https://lh3.googleusercontent.com/u/0/d/14wx6DlgO3bZ6rSIhQQz6wRzlLrBgwNAp=w1000-h1000";

        function App() {
            const [user, setUser] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);
            const [activeTab, setActiveTab] = useState("commandes");
            const [loading, setLoading] = useState(true);

            const [clients, setClients] = useState([]);
            const [livraisons, setLivraisons] = useState([]);
            const [depenses, setDepenses] = useState([]);

            const [searchTerm, setSearchTerm] = useState("");
            const [orderForm, setOrderForm] = useState({ nom: "", telephone: "", montant: "", lieu: "", source: "Facebook", remarque: "", isColis: false });
            const [clientForm, setClientForm] = useState({ nom: "", telephone: "", lieu: "", source: "Facebook", remarque: "" });
            const [depenseForm, setDepenseForm] = useState({ motif: "", montant: "" });

            useEffect(() => {
                const checkFirebase = setInterval(() => {
                    if (window.FirebaseSDK) {
                        clearInterval(checkFirebase);
                        const { onAuthStateChanged, auth } = window.FirebaseSDK;
                        onAuthStateChanged(auth, (u) => {
                            setUser(u);
                            setLoading(false);
                        });
                    }
                }, 50);
                return () => clearInterval(checkFirebase);
            }, []);

            useEffect(() => {
                if (!user || !window.FirebaseSDK) return;
                const { db, collection, onSnapshot } = window.FirebaseSDK;
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'rasoa-pro-v2';
                
                const getColRef = (name) => collection(db, 'artifacts', appId, 'public', 'data', name);
                
                const unsubLiv = onSnapshot(getColRef('livraisons'), (s) => setLivraisons(s.docs.map(d => ({ id: d.id, ...d.data() }))), (e) => console.error(e));
                const unsubCli = onSnapshot(getColRef('clients'), (s) => setClients(s.docs.map(d => ({ id: d.id, ...d.data() }))), (e) => console.error(e));
                const unsubDep = onSnapshot(getColRef('depenses'), (s) => setDepenses(s.docs.map(d => ({ id: d.id, ...d.data() }))), (e) => console.error(e));
                
                return () => { unsubLiv(); unsubCli(); unsubDep(); };
            }, [user]);

            const stats = useMemo(() => {
                const totalVentesLivrees = livraisons.filter(l => l.statut === "Livré").reduce((acc, curr) => acc + (Number(curr.montant) || 0), 0);
                const totalDepenses = depenses.reduce((acc, curr) => acc + (Number(curr.montant) || 0), 0);
                return { entrees: totalVentesLivrees, depenses: totalDepenses, solde: totalVentesLivrees - totalDepenses };
            }, [livraisons, depenses]);

            const filteredClients = useMemo(() => {
                if (!searchTerm || searchTerm.length < 1) return [];
                return clients.filter(c => 
                    (c.nom && c.nom.toLowerCase().includes(searchTerm.toLowerCase())) || 
                    (c.telephone && c.telephone.includes(searchTerm))
                );
            }, [searchTerm, clients]);

            const handleEnterApp = () => {
                setIsAdmin(true);
            };

            const addOrder = async () => {
                if (!orderForm.nom || !orderForm.montant) return;
                const { db, collection, addDoc, serverTimestamp } = window.FirebaseSDK;
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'rasoa-pro-v2';
                try {
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'livraisons'), {
                        ...orderForm,
                        montant: Number(orderForm.montant),
                        statut: "Préparation",
                        timestamp: serverTimestamp(),
                        date: new Date().toLocaleDateString('fr-FR')
                    });
                    if (!clients.find(c => c.telephone === orderForm.telephone)) {
                        await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'clients'), {
                            nom: orderForm.nom,
                            telephone: orderForm.telephone,
                            lieu: orderForm.lieu,
                            source: orderForm.source,
                            remarque: orderForm.remarque,
                            timestamp: serverTimestamp()
                        });
                    }
                    setOrderForm({ nom: "", telephone: "", montant: "", lieu: "", source: "Facebook", remarque: "", isColis: false });
                    setActiveTab("livraisons");
                } catch(e) { console.error(e); }
            };

            const addManualClient = async () => {
                if (!clientForm.nom || !clientForm.telephone) return;
                const { db, collection, addDoc, serverTimestamp } = window.FirebaseSDK;
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'rasoa-pro-v2';
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'clients'), {
                    ...clientForm,
                    timestamp: serverTimestamp()
                });
                setClientForm({ nom: "", telephone: "", lieu: "", source: "Facebook", remarque: "" });
            };

            const addDepense = async () => {
                if (!depenseForm.motif || !depenseForm.montant) return;
                const { db, collection, addDoc, serverTimestamp } = window.FirebaseSDK;
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'rasoa-pro-v2';
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'depenses'), { 
                    ...depenseForm, 
                    montant: Number(depenseForm.montant), 
                    timestamp: serverTimestamp(),
                    date: new Date().toLocaleDateString('fr-FR')
                });
                setDepenseForm({ motif: "", montant: "" });
            };

            const updateStatus = async (id, current) => {
                const { db, doc, updateDoc } = window.FirebaseSDK;
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'rasoa-pro-v2';
                const next = current === "Préparation" ? "Livraison" : "Livré";
                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'livraisons', id), { statut: next });
            };

            const deleteItem = async (col, id) => {
                if (confirm("Supprimer définitivement ?")) {
                    const { db, doc, deleteDoc } = window.FirebaseSDK;
                    const appId = typeof __app_id !== 'undefined' ? __app_id : 'rasoa-pro-v2';
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', col, id));
                }
            };

            if (loading) return (
                <div className="flex flex-col items-center justify-center min-h-screen bg-white">
                    <div className="w-12 h-12 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"></div>
                    <p className="mt-4 font-black text-xs uppercase tracking-widest text-slate-400">Chargement des données...</p>
                </div>
            );

            if (!isAdmin) return (
                <div className="flex items-center justify-center min-h-screen p-4 relative overflow-hidden bg-white">
                    <div className="fixed top-6 right-6 z-50">
                        <button onClick={handleEnterApp} className="group flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-full text-[11px] font-black uppercase tracking-widest transition-all shadow-xl active:scale-90">
                            Accéder au Site
                            <Icons.ChevronRight size={14} className="group-hover:translate-x-1 transition-transform" />
                        </button>
                    </div>

                    <div className="animated-blob bg-indigo-100 top-[-10%] left-[-10%]"></div>
                    <div className="animated-blob bg-sky-100 bottom-[-10%] right-[-10%]"></div>
                    
                    <div className="text-center relative z-10 animate-in fade-in zoom-in duration-700">
                        <img src={LOGO_URL} className="w-32 h-32 rounded-full mx-auto mb-10 object-cover border-8 border-white shadow-2xl" />
                        <h1 className="font-black text-5xl text-slate-900 mb-2 uppercase tracking-tighter">Rasoa <span className="text-indigo-600">Pro</span></h1>
                        <p className="text-slate-400 font-bold text-xs uppercase tracking-[0.3em] mb-12">Gestion Commerciale & Data</p>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen relative flex flex-col pb-20 overflow-x-hidden bg-slate-50/50">
                    <nav className="glass-card px-6 h-24 flex items-center justify-between sticky top-0 z-50 border-b border-white/50">
                        <div className="flex items-center gap-4">
                            <img src={LOGO_URL} className="w-12 h-12 rounded-full border shadow-sm" />
                            <div>
                                <h1 className="font-black text-xl tracking-tighter uppercase text-slate-800">Rasoa <span className="text-indigo-600">Pro</span></h1>
                                <p className="text-[9px] font-bold text-slate-400 uppercase tracking-widest">Connecté</p>
                            </div>
                        </div>
                        <button onClick={() => setIsAdmin(false)} className="text-slate-500 font-black text-[10px] uppercase border-2 border-slate-200 px-6 py-3 rounded-full hover:bg-slate-800 hover:text-white hover:border-slate-800 transition-all">Quitter</button>
                    </nav>

                    <div className="glass-card border-b sticky top-24 z-40 overflow-x-auto no-scrollbar">
                        <div className="max-w-5xl mx-auto flex">
                            {[
                                {id: 'commandes', label: 'Vente', icon: Icons.ShoppingCart}, 
                                {id: 'livraisons', label: 'Livraisons', icon: Icons.Truck}, 
                                {id: 'finances', label: 'Finances', icon: Icons.Wallet}, 
                                {id: 'clients', label: 'Clients', icon: Icons.Users}
                            ].map(t => (
                                <button key={t.id} onClick={() => setActiveTab(t.id)} className={`px-8 py-6 border-b-4 font-black text-[10px] uppercase transition-all flex items-center gap-3 ${activeTab === t.id ? 'border-indigo-600 text-indigo-600 bg-white' : 'border-transparent text-slate-400 hover:text-slate-600'}`}>
                                    <t.icon size={16} /> {t.label}
                                </button>
                            ))}
                        </div>
                    </div>

                    <main className="max-w-5xl mx-auto w-full p-4 md:p-8 relative z-10">
                        {activeTab === 'commandes' && (
                            <div className="max-w-lg mx-auto glass-card rounded-[3rem] p-10 shadow-2xl border-white/50 space-y-6 animate-in slide-in-from-bottom-10 duration-500">
                                <div className="text-center">
                                    <h2 className="text-2xl font-black uppercase text-slate-800 mb-1">Encaisser</h2>
                                    <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Nouvelle fiche de vente</p>
                                </div>
                                
                                <div className="relative">
                                    <input value={searchTerm} onChange={e => setSearchTerm(e.target.value)} placeholder="Rechercher client existant..." className="w-full p-5 bg-white rounded-3xl border-2 border-slate-100 font-bold outline-none focus:border-indigo-500 transition-all text-sm" />
                                    {filteredClients.length > 0 && (
                                        <div className="absolute z-10 w-full mt-3 bg-white border-2 border-indigo-50 rounded-3xl shadow-2xl max-h-60 overflow-y-auto p-2 no-scrollbar">
                                            {filteredClients.map(c => (
                                                <div key={c.id} onClick={() => { setOrderForm({...orderForm, nom: c.nom, telephone: c.telephone, lieu: c.lieu || "", source: c.source || 'Facebook', remarque: c.remarque || ''}); setSearchTerm(""); }} 
                                                     className="p-4 hover:bg-indigo-50 cursor-pointer rounded-2xl flex items-center justify-between mb-1">
                                                    <div>
                                                        <div className="font-black text-slate-800 text-sm uppercase">{c.nom}</div>
                                                        <div className="text-[10px] text-indigo-500 font-bold">{c.telephone}</div>
                                                    </div>
                                                    {c.source === 'TikTok' ? <Icons.TikTok size={14} className="text-rose-500" /> : <Icons.Facebook size={14} className="text-blue-600" />}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <input value={orderForm.nom} onChange={e => setOrderForm({...orderForm, nom: e.target.value})} placeholder="Nom" className="p-4 bg-white rounded-2xl border border-slate-100 font-bold outline-none" />
                                    <input value={orderForm.telephone} onChange={e => setOrderForm({...orderForm, telephone: e.target.value})} placeholder="Téléphone" className="p-4 bg-white rounded-2xl border border-slate-100 font-bold outline-none" />
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <input value={orderForm.lieu} onChange={e => setOrderForm({...orderForm, lieu: e.target.value})} placeholder="Quartier/Ville" className="p-4 bg-white rounded-2xl border border-slate-100 font-bold outline-none" />
                                    <div className="flex gap-2 p-1 bg-slate-100 rounded-2xl">
                                        <button onClick={() => setOrderForm({...orderForm, source: 'Facebook'})} className={`flex-1 flex items-center justify-center py-3 rounded-xl transition-all ${orderForm.source === 'Facebook' ? 'bg-blue-600 text-white shadow-md' : 'text-slate-400'}`}><Icons.Facebook size={18} /></button>
                                        <button onClick={() => setOrderForm({...orderForm, source: 'TikTok'})} className={`flex-1 flex items-center justify-center py-3 rounded-xl transition-all ${orderForm.source === 'TikTok' ? 'bg-slate-900 text-white shadow-md' : 'text-slate-400'}`}><Icons.TikTok size={18} /></button>
                                    </div>
                                </div>

                                <div className="p-4 bg-slate-50 rounded-2xl flex items-center justify-between border border-slate-100">
                                    <div className="flex items-center gap-3">
                                        <div className="p-2 bg-indigo-100 rounded-lg text-indigo-600"><Icons.Package size={16}/></div>
                                        <span className="text-[10px] font-black uppercase text-slate-600">Envoi par colis</span>
                                    </div>
                                    <input type="checkbox" checked={orderForm.isColis} onChange={e => setOrderForm({...orderForm, isColis: e.target.checked})} className="w-6 h-6 accent-indigo-600 cursor-pointer" />
                                </div>

                                <div className="relative">
                                    <input type="number" value={orderForm.montant} onChange={e => setOrderForm({...orderForm, montant: e.target.value})} placeholder="0" className="w-full p-6 bg-indigo-600 rounded-[2rem] font-black text-4xl text-white text-center outline-none shadow-xl shadow-indigo-100" />
                                    <span className="absolute right-8 top-1/2 -translate-y-1/2 font-black text-indigo-200">Ar</span>
                                </div>

                                <textarea value={orderForm.remarque} onChange={e => setOrderForm({...orderForm, remarque: e.target.value})} placeholder="Notes additionnelles..." className="w-full p-5 bg-white rounded-2xl border border-slate-100 font-bold outline-none min-h-[100px] text-sm"></textarea>
                                
                                <button onClick={addOrder} className="w-full bg-slate-900 text-white py-6 rounded-[2rem] font-black uppercase tracking-widest shadow-2xl hover:bg-indigo-700 active:scale-95 transition-all">Enregistrer Vente</button>
                            </div>
                        )}

                        {activeTab === 'livraisons' && (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-in fade-in duration-500">
                                {livraisons.length === 0 && <div className="col-span-full text-center py-32 text-slate-300 font-black uppercase text-[10px] tracking-widest">Aucune livraison en attente</div>}
                                {livraisons.sort((a,b) => b.timestamp - a.timestamp).map(l => (
                                    <div key={l.id} className="glass-card rounded-[2.5rem] border-2 p-8 shadow-sm hover:shadow-2xl transition-all relative overflow-hidden group border-white">
                                        {l.isColis && <div className="absolute top-6 right-6 bg-indigo-600 text-white px-4 py-1.5 rounded-full text-[9px] font-black uppercase flex items-center gap-2"><Icons.Package size={12} /> Colis</div>}
                                        <div className="text-[9px] font-black uppercase text-slate-400 mb-6 flex items-center gap-2">
                                            <span className="w-2 h-2 rounded-full bg-indigo-400 animate-pulse"></span>
                                            {l.date} • {l.statut}
                                        </div>
                                        <h3 className="font-black text-xl mb-1 text-slate-800">{l.nom}</h3>
                                        <p className="text-sm text-indigo-600 font-black mb-4 flex items-center gap-2">{l.telephone}</p>
                                        <div className="flex items-center gap-2 text-[10px] text-slate-500 font-black uppercase mb-6 bg-slate-50 p-3 rounded-xl">Destination: {l.lieu}</div>
                                        
                                        <div className="flex justify-between items-center border-t border-slate-100 pt-6">
                                            <span className="font-black text-slate-900 text-xl">{Number(l.montant || 0).toLocaleString()} <span className="text-[10px] text-slate-400">Ar</span></span>
                                            <div className="flex gap-3">
                                                <button onClick={() => deleteItem('livraisons', l.id)} className="p-3 text-slate-300 hover:text-rose-500 hover:bg-rose-50 rounded-xl transition-all"><Icons.Trash2 size={20}/></button>
                                                {l.statut !== 'Livré' && (
                                                    <button onClick={() => updateStatus(l.id, l.statut)} className="bg-slate-900 text-white px-6 py-3 rounded-2xl text-[10px] font-black uppercase shadow-lg active:scale-95 transition-all flex items-center gap-2 group-hover:bg-indigo-600">
                                                        {l.statut === 'Préparation' ? 'Expédier' : 'Terminer'}
                                                        <Icons.ChevronRight size={14}/>
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'finances' && (
                            <div className="space-y-8 animate-in fade-in duration-500">
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className="glass-card p-10 rounded-[3rem] shadow-sm border-white">
                                        <div className="text-[10px] font-black text-slate-400 uppercase mb-3 tracking-widest">Total Ventes</div>
                                        <div className="text-3xl font-black text-emerald-600">+{stats.entrees.toLocaleString()} Ar</div>
                                    </div>
                                    <div className="glass-card p-10 rounded-[3rem] shadow-sm border-white">
                                        <div className="text-[10px] font-black text-slate-400 uppercase mb-3 tracking-widest">Total Dépenses</div>
                                        <div className="text-3xl font-black text-rose-500">-{stats.depenses.toLocaleString()} Ar</div>
                                    </div>
                                    <div className="bg-slate-900 p-10 rounded-[3rem] text-white shadow-2xl shadow-indigo-100">
                                        <div className="text-[10px] font-black uppercase mb-3 opacity-50 tracking-widest">Balance Finale</div>
                                        <div className="text-4xl font-black">{stats.solde.toLocaleString()} <span className="text-sm opacity-50">Ar</span></div>
                                    </div>
                                </div>
                                <div className="glass-card rounded-[3rem] p-10 shadow-sm border-white max-w-2xl mx-auto">
                                    <h3 className="font-black uppercase text-[11px] text-slate-800 mb-8 tracking-widest text-center">Déclarer une dépense</h3>
                                    <div className="space-y-4">
                                        <input value={depenseForm.motif} onChange={e => setDepenseForm({...depenseForm, motif: e.target.value})} placeholder="Nature de la dépense..." className="w-full p-5 bg-white rounded-2xl border-2 border-slate-50 font-bold outline-none focus:border-rose-100" />
                                        <div className="flex gap-4">
                                            <input type="number" value={depenseForm.montant} onChange={e => setDepenseForm({...depenseForm, montant: e.target.value})} placeholder="Montant" className="flex-1 p-5 bg-white rounded-2xl border-2 border-slate-50 font-bold outline-none text-rose-500" />
                                            <button onClick={addDepense} className="bg-rose-500 text-white px-10 rounded-2xl font-black uppercase text-[11px] shadow-lg active:scale-95 transition-all">Valider</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'clients' && (
                            <div className="space-y-8 animate-in fade-in duration-500">
                                <div className="glass-card rounded-[3rem] p-8 shadow-sm border-white max-w-4xl mx-auto">
                                    <h3 className="font-black uppercase text-[11px] text-slate-800 mb-6 tracking-widest text-center flex items-center justify-center gap-3">
                                        <Icons.Plus size={16} /> Nouveau client
                                    </h3>
                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                                        <input value={clientForm.nom} onChange={e => setClientForm({...clientForm, nom: e.target.value})} placeholder="Nom complet" className="p-4 bg-white rounded-2xl border border-slate-100 font-bold outline-none" />
                                        <input value={clientForm.telephone} onChange={e => setClientForm({...clientForm, telephone: e.target.value})} placeholder="Téléphone" className="p-4 bg-white rounded-2xl border border-slate-100 font-bold outline-none" />
                                        <input value={clientForm.lieu} onChange={e => setClientForm({...clientForm, lieu: e.target.value})} placeholder="Localisation" className="p-4 bg-white rounded-2xl border border-slate-100 font-bold outline-none" />
                                        <div className="flex gap-1 p-1 bg-slate-100 rounded-2xl">
                                            <button onClick={() => setClientForm({...clientForm, source: 'Facebook'})} className={`flex-1 flex items-center justify-center rounded-xl transition-all ${clientForm.source === 'Facebook' ? 'bg-blue-600 text-white shadow-sm' : 'text-slate-400'}`}><Icons.Facebook size={16} /></button>
                                            <button onClick={() => setClientForm({...clientForm, source: 'TikTok'})} className={`flex-1 flex items-center justify-center rounded-xl transition-all ${clientForm.source === 'TikTok' ? 'bg-slate-900 text-white shadow-sm' : 'text-slate-400'}`}><Icons.TikTok size={16} /></button>
                                        </div>
                                    </div>
                                    <button onClick={addManualClient} className="w-full mt-4 bg-indigo-600 text-white py-4 rounded-2xl font-black uppercase text-[11px] tracking-widest shadow-xl active:scale-95 transition-all">Enregistrer</button>
                                </div>

                                <div className="glass-card rounded-[3rem] overflow-hidden shadow-sm border-white border-2">
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-left">
                                            <thead className="bg-slate-100/50 text-[10px] font-black uppercase text-slate-500 border-b">
                                                <tr><th className="p-8">Identité</th><th className="p-8">Contact</th><th className="p-8">Source</th><th className="p-8 text-right">Actions</th></tr>
                                            </thead>
                                            <tbody className="divide-y-2 divide-slate-50 font-bold">
                                                {clients.sort((a,b) => (a.nom || "").localeCompare(b.nom || "")).map(c => (
                                                    <tr key={c.id} className="hover:bg-white transition-colors">
                                                        <td className="p-8 uppercase text-slate-800">{c.nom}</td>
                                                        <td className="p-8 text-indigo-600 font-black">{c.telephone}</td>
                                                        <td className="p-8">
                                                            {c.source === 'TikTok' ? (
                                                                <div className="flex items-center gap-2 text-rose-500 text-[10px] uppercase font-black"><Icons.TikTok size={14}/> TikTok</div>
                                                            ) : (
                                                                <div className="flex items-center gap-2 text-blue-600 text-[10px] uppercase font-black"><Icons.Facebook size={14}/> Facebook</div>
                                                            )}
                                                        </td>
                                                        <td className="p-8 text-right">
                                                            <button onClick={() => deleteItem('clients', c.id)} className="p-3 text-slate-200 hover:text-rose-500 hover:bg-rose-50 rounded-xl transition-all"><Icons.Trash2 size={18}/></button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
